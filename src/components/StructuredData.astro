---
import type { CollectionEntry } from "astro:content";
import { siteConfig } from "@/site.config";

interface Props {
  post?: CollectionEntry<"post">;
  type?: "website" | "article" | "organization" | "breadcrumblist";
}

const { post, type = "website" } = Astro.props;
const canonicalURL = new URL(Astro.url.pathname, Astro.site);

let structuredData: any = {};

if (type === "website") {
  structuredData = {
    "@context": "https://schema.org",
    "@type": "WebSite",
    name: "MaiPDF - Secure PDF Sharing Platform",
    description: "Convert PDF files into shareable links or QR codes with access restrictions, copy protection, and tracking features. Secure PDF hosting and sharing solution.",
    url: Astro.site?.toString(),
    potentialAction: {
      "@type": "SearchAction",
      target: {
        "@type": "EntryPoint",
        urlTemplate: `${Astro.site}posts/?q={search_term_string}`
      },
      "query-input": "required name=search_term_string"
    },
    publisher: {
      "@type": "Organization",
      name: "MaiPDF Team",
      url: Astro.site?.toString(),
      logo: {
        "@type": "ImageObject",
        url: `${Astro.site}icon.svg`,
        width: 60,
        height: 60
      }
    },
    sameAs: [
      "https://maipdf.com"
    ]
  };
} else if (type === "organization") {
  structuredData = {
    "@context": "https://schema.org",
    "@type": "Organization",
    name: "MaiPDF",
    alternateName: "PDF Host Online",
    url: Astro.site?.toString(),
    logo: {
      "@type": "ImageObject",
      url: `${Astro.site}icon.svg`,
      width: 60,
      height: 60
    },
    description: "Secure PDF sharing platform with access controls, tracking, and dynamic permissions. Convert PDFs to protected links and QR codes.",
    foundingDate: "2024",
    serviceType: [
      "PDF Sharing",
      "Document Security", 
      "PDF to Link Conversion",
      "PDF QR Code Generator",
      "Document Access Control"
    ],
    areaServed: "Worldwide",
    sameAs: [
      "https://maipdf.com"
    ]
  };
} else if (type === "article" && post) {
  const { title, description, publishDate, updatedDate, tags } = post.data;
  structuredData = {
    "@context": "https://schema.org",
    "@type": "Article",
    headline: title,
    description: description,
    author: {
      "@type": "Organization",
      name: "MaiPDF Team",
      url: Astro.site?.toString()
    },
    publisher: {
      "@type": "Organization",
      name: "MaiPDF",
      logo: {
        "@type": "ImageObject",
        url: `${Astro.site}icon.svg`,
        width: 60,
        height: 60
      }
    },
    datePublished: publishDate.toISOString(),
    dateModified: (updatedDate || publishDate).toISOString(),
    mainEntityOfPage: {
      "@type": "WebPage",
      "@id": canonicalURL.toString()
    },
    keywords: tags?.join(", "),
    articleSection: "PDF Security and Sharing",
    inLanguage: "en-US",
    about: {
      "@type": "Thing",
      name: "PDF Security",
      description: "Methods and tools for securing PDF documents"
    }
  };
  
  // 如果有封面图片，添加图片信息
  if (post.data.ogImage) {
    structuredData.image = {
      "@type": "ImageObject",
      url: `${Astro.site}${post.data.ogImage.replace(/^\//, "")}`,
      width: 1200,
      height: 630
    };
  }
} else if (type === "breadcrumblist") {
  const pathSegments = Astro.url.pathname.split('/').filter(segment => segment);
  const breadcrumbItems = [
    {
      "@type": "ListItem",
      position: 1,
      name: "Home",
      item: Astro.site?.toString()
    }
  ];
  
  let currentPath = Astro.site?.toString() || '';
  pathSegments.forEach((segment, index) => {
    currentPath += segment + '/';
    const name = segment.charAt(0).toUpperCase() + segment.slice(1).replace(/-/g, ' ');
    breadcrumbItems.push({
      "@type": "ListItem",
      position: index + 2,
      name: name,
      item: currentPath
    });
  });

  structuredData = {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    itemListElement: breadcrumbItems
  };
}
---

<script type="application/ld+json" set:html={JSON.stringify(structuredData)} />
